Root Cause

Your current CDE CLI binary (cde-env-tool v1.22.2-b34) is configured by default to use the CDP Public Control Plane for token exchange (even if you pass --vcluster-endpoint).
This behavior must be overridden manually for Private Cloud CDE clusters like yours.

In short:

The CLI is trying ‚Üí https://api.us-west-1.cdp.cloudera.com
But should talk ‚Üí https://4n9wpd5l.cde-k4sg67rt.apps.mlab-ctigtdcai03d.ecs.dyn.nsroot.net/dex/api/v1

‚úÖ Step-by-Step Fix (for private CDE)
1Ô∏è‚É£ Make sure your credentials file is clean
cat /root/.cdp/credentials


It should look exactly like this:

[default]
cdp_access_key_id = 98a02947-7cd0-494f-a0f0-969309da9020
cdp_private_key = N4nk9VzYfBb9CVdCzCCm7Wmduy65Wso+mgIGZ/vJ6xg=


No extra spaces or hidden characters at the end of the key.
If you downloaded from the Cloudera console, copy the contents cleanly (avoid smart quotes or carriage returns).

2Ô∏è‚É£ Create an environment variable to override region and disable Control Plane autodetect

Run:

export CDE_CLI_CONTROL_PLANE_BYPASS=true
export CDE_DISABLE_CLOUD_API=true


These two environment variables force the CLI to bypass the public CDP Control Plane and use only your --vcluster-endpoint.

3Ô∏è‚É£ Retry with this working command
./cde resource create \
  --name spark-examples \
  --type files \
  --vcluster-endpoint https://4n9wpd5l.cde-k4sg67rt.apps.mlab-ctigtdcai03d.ecs.dyn.nsroot.net/dex/api/v1 \
  --credentials-file /root/.cdp/credentials \
  --tls-insecure \
  --verbose


‚úÖ Expected:

CLI should not try to hit any cdp.cloudera.com domains.

Should connect directly to your CDE virtual cluster endpoint (4n9wpd5l...).

Should return a JSON confirmation of resource creation or a permissions-related error (if cluster policies are still restricted).

4Ô∏è‚É£ (If still fails) ‚Äî try ‚Äúoffline mode‚Äù syntax

Some older CDE CLI builds require the environment explicitly declared via CDP_ENV_ID and cluster ID bypass.
Run this before retrying:

export CDE_VC_ENDPOINT=https://4n9wpd5l.cde-k4sg67rt.apps.mlab-ctigtdcai03d.ecs.dyn.nsroot.net/dex/api/v1


Then:

./cde resource create \
  --name spark-examples \
  --type files \
  --vcluster-endpoint $CDE_VC_ENDPOINT \
  --credentials-file /root/.cdp/credentials \
  --tls-insecure \
  --verbose

üß† If it still tries to resolve api.us-west-1.cdp.cloudera.com




-----------------

Step 1. Set ‚ÄúPrivate Mode‚Äù environment variable

Run this exactly:

export CDE_FORM_FACTOR=private


This tells the CLI to skip all CDP public API discovery and use the endpoint you pass directly.

You can confirm it took effect:

echo $CDE_FORM_FACTOR


It should print:

private

‚úÖ Step 2. Clean and retry the same command

Now rerun:

./cde resource create \
  --name spark-examples \
  --type files \
  --vcluster-endpoint https://4n9wpd5l.cde-k4sg67rt.apps.mlab-ctigtdcai03d.ecs.dyn.nsroot.net/dex/api/v1 \
  --credentials-file /root/.cdp/credentials \
  --tls-insecure \
  --verbose

‚úÖ Step 3. Expected Output

If the CDE_FORM_FACTOR=private variable is set correctly, you‚Äôll no longer see:

api.us-west-1.cdp.cloudera.com/api/v1/de/describeService


Instead, you‚Äôll see:

POST https://4n9wpd5l.cde-k4sg67rt.apps.mlab-ctigtdcai03d.ecs.dyn.nsroot.net/dex/api/v1/resources


If successful:

INFO Successfully created resource spark-examples (type: files)

üß© Optional ‚Äî make this permanent

If it works, make sure you never have to re-export it:

echo 'export CDE_FORM_FACTOR=private' >> ~/.bashrc



---------
Step-by-Step Fix
1Ô∏è‚É£ Explicitly define the correct endpoint variable

Run this first (note the quotes and the full https://):

export CDE_VC_ENDPOINT="https://4n9wpd5l.cde-k4sg67rt.apps.mlab-ctigtdcai03d.ecs.dyn.nsroot.net/dex/api/v1"


Confirm it:

echo $CDE_VC_ENDPOINT


It must print the entire URL starting with https:// exactly as above.

2Ô∏è‚É£ Clean up any cached tokens (old attempts used invalid endpoint paths)
rm -rf ~/.cache/cloudera/cde/token-cache

3Ô∏è‚É£ Run the command again (with correct endpoint)
./cde resource create \
  --name spark-examples \
  --type files \
  --vcluster-endpoint "$CDE_VC_ENDPOINT" \
  --credentials-file /root/.cdp/credentials \
  --tls-insecure \
  --verbose



If it still tries to reach altus.cloudera.com, please share the output of:

./cde version
